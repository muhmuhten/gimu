- hosts: fedora
  vars:
    ansible_ssh_user: root
    ansible_ssh_port: 22
  tasks:
    - command: semanage port -at ssh_port_t -p tcp 3622
      failed_when: no
      register: semanage_res
      changed_when: semanage_res.rc == 0
      notify: reload sshd
    - name: copy sshd_config
      synchronize:
        src: files/sshd_config
        dest: /etc/ssh/sshd_config
        rsync_opts:
          - --chown=0:0
          - --chmod=600
      notify: reload sshd
  handlers:
    - name: reload sshd
      service: name=sshd state=reloaded
